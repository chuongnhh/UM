@{
    ViewBag.Title = "Trang chủ";
}
@section styles{
    <link href="~/Content/alertifyjs/alertify.min.css" rel="stylesheet" />
    @*<link href="~/Content/alertifyjs/themes/bootstrap.min.css" rel="stylesheet" />*@
    <link href="~/Content/alertifyjs/themes/default.min.css" rel="stylesheet" />
    <link href="~/Content/font-awesome.min.css" rel="stylesheet" />
}
@section scripts{
    <script src="~/Scripts/alertify.min.js"></script>
    <script src="~/Scripts/mustache.js"></script>
    <script>
        //alertify.alert('Anh Chương có lời nhắn nhủ với bạn!',
        //    'Bạn chưa tải tệp lên mừ, làm sao mà tui xử lý đây!').set('label', 'Tôi đã hiểu rồi');

        function notify() {
            console.log('notify');
            alertify.alert('Anh Chương có lời nhắn nhủ với bạn!',
                'Bạn chưa tải tệp lên mừ, làm sao mà tui xử lý đây!').set('label', 'Tôi đã hiểu rồi');
        }

        $('#download').off('click').on('click', notify);
        $('#download1').off('click').on('click', notify);

        $('#UploadedFile').change(function () {
            $('#submit').click();
        });

        $('form').on('submit', function (e) {
            e.preventDefault();

            var data = new FormData(this);

            $.ajax({
                type: 'post',
                url: '/home/upload',
                data: data,
                success: function (res) {
                    console.log(res.status);
                    if (res.status == false) {
                        alertify.alert('Anh Chương có lời nhắn nhủ với bạn!',
                            'Bạn chưa chọn tệp hoặc là tệp không đúng định dạng, bạn vui lòng kiểm tra lại trước khi tải lên.').set('label', 'Tôi đã hiểu rồi');

                        $('#download').off('click').on('click', notify);
                        $('#download1').off('click').on('click', notify);
                    }
                    else {
                        var data = res.data;
                        var rendered = '';
                        var template = $('#template').html();
                        $.each(data, function (i, item) {
                            rendered += Mustache.render(template, {
                                Id: i + 1,
                                HoTen: item.HoTen,
                                DienThoai: item.DienThoai,

                                ThoiGian1: item.ThoiGian1,
                                Ca1: item.Ca1,
                                ThoiGian2: item.ThoiGian2,
                                Ca2: item.Ca2,
                                ThoiGian3: item.ThoiGian3,
                                Ca3: item.Ca3,
                                KickSale: item.KickSale,
                                Ngay: item.Ngay
                            });
                        });
                        $('#target').html(rendered);

                        $('#download').off('click').on('click', function () {
                            console.log('download');
                            window.location.href = '/home/download';
                        });
                        $('#download1').off('click').on('click', function () {
                            console.log('download1');
                            window.location.href = '/home/download1';
                        });
                    }
                },
                cache: false,
                contentType: false,
                processData: false
            })
        })
    </script>
}

<nav class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">chuongnh</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <form action="/home/upload" enctype="multipart/form-data" class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="file" class="form-control" name="UploadedFile" id="UploadedFile">
                </div>
                <button type="submit" id="submit" class="btn btn-primary"><i class="fa fa-upload"></i> Tải lên...</button>
            </form>
            <form action="" enctype="multipart/form-data" class="navbar-form navbar-right">
                <button id="download" type="button" class="btn btn-primary">
                    <i class="fa fa-download"></i> Tính lương
                </button>
                <button id="download1" type="button" class="btn btn-primary">
                    <i class="fa fa-download"></i> Gộp theo tuần
                </button>
            </form>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container -->
</nav>

<div class="container">
    <table class="table table-responsive table-hover table-bordered">
        <thead>
            <tr>
                <th>STT</th>
                <th>Họ tên</th>
                <th>Điện thoại</th>
                <th>Ca sáng</th>
                <th>Công việc</th>
                <th>Ca chiều</th>
                <th>Công việc</th>
                <th>Ca tối</th>
                <th>Công việc</th>
                <th>Kick Sales</th>
            </tr>
        </thead>
        <tbody id="target"></tbody>
    </table>
</div>
<script id="template" type="x-tmpl-mustache">
    <tr>
        <td>{{Id}}</td>
        <td>{{HoTen}}</td>
        <td>{{DienThoai}}</td>
        <td>{{ThoiGian1}}</td>
        <td>{{Ca1}}</td>
        <td>{{ThoiGian2}}</td>
        <td>{{Ca2}}</td>
        <td>{{ThoiGian3}}</td>
        <td>{{Ca3}}</td>
        <td>{{KickSale}}</td>
    </tr>
</script>

